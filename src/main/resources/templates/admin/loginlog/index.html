<!DOCTYPE html>
<html lang="en">
<head>
    <title>LoginLog List</title>
    <#include "/header.html">
</head>
<body>
<!-- START PAGE CONTAINER -->
<div class="page-container">
    <!-- START PAGE SIDEBAR -->
    <div class="page-sidebar">
        <!-- START X-NAVIGATION -->
        <ul class="x-navigation">
            <li class="xn-logo">
                <a href="#">WEB OS</a>
                <a href="#" class="x-navigation-control"></a>
            </li>
            <li class="xn-title"></li>
            <li>
                <a href="${ctxPath!}/admin/index"><span class="fa fa-home"></span> <span class="xn-text"><@spring.message "Home"/></span></a>
            </li>
            <li class="xn-openable">
                <a href="#"><span class="fa fa-dashboard"></span> <span class="xn-text"><@spring.message "Dashboards"/></span></a>
                <ul>
                    <@shiro.hasPermission name="system:user:index">
                    <li><a href="${ctxPath!}/admin/user/index"><span class="fa fa-user"></span><@spring.message "UserM"/></a></li>
                    </@shiro.hasPermission>
                    <@shiro.hasPermission name="system:role:index">
                    <li><a href="${ctxPath!}/admin/role/index"><span class="fa fa-wrench"></span><@spring.message "RoleM"/></a></li>
                    </@shiro.hasPermission>
                    <@shiro.hasPermission name="system:resource:index">
                    <li><a href="${ctxPath!}/admin/resource/index"><span class="fa fa-users"></span><@spring.message "ResourceM"/></a></li>
                    </@shiro.hasPermission>
                    <@shiro.hasPermission name="system:notice:index">
                    <li><a href="${ctxPath!}/admin/notice/index"><span class="fa fa-warning"></span><@spring.message "NoticeM"/></a></li>
                    </@shiro.hasPermission>
                    <@shiro.hasPermission name="system:loginlog:index">
                    <li><a href="${ctxPath!}/admin/loginlog/index"><span class="fa fa-file-o"></span><@spring.message "LoginlogM"/></a></li>
                    </@shiro.hasPermission>
                    <@shiro.hasPermission name="system:log:index">
                    <li><a href="${ctxPath!}/admin/log/index"><span class="fa fa-file-o"></span><@spring.message "LogM"/></a></li>
                    </@shiro.hasPermission>
                </ul>
            </li>
        </ul>
<!-- END X-NAVIGATION -->
</div>
<!-- END PAGE SIDEBAR -->

<!-- PAGE CONTENT -->
<div class="page-content">

    <!-- START X-NAVIGATION VERTICAL -->
    <ul class="x-navigation x-navigation-horizontal x-navigation-panel">
        <!-- TOGGLE NAVIGATION -->
        <li class="xn-icon-button">
            <a href="#" class="x-navigation-minimize"><span class="fa fa-dedent"></span></a>
        </li>
        <!-- END TOGGLE NAVIGATION -->
        <!-- SEARCH -->
        <li class="xn-search">
            <form role="form">
                <input type="text" name="search" placeholder="Search..."/>
            </form>
        </li>
        <!-- END SEARCH -->
        <!-- POWER OFF -->
        <li class="xn-icon-button pull-right last">
            <a href="#"><span class="fa fa-power-off"></span></a>
            <ul class="xn-drop-left">
                <li><a href="#" class="mb-control" data-box="#mb-signout"><span class="fa fa-sign-out"></span>&nbsp;<@spring.message "SignOut"/></a></li>
            </ul>
        </li>
        <!-- END POWER OFF -->
    </ul>
    <!-- END X-NAVIGATION VERTICAL -->

    <ul class="breadcrumb">
        <li>
            <a href="${ctxPath!}/admin/index"><span class="fa fa-home"></span> <span class="xn-text"><@spring.message "Home"/></span></a>
        </li>
        <li>
            <span class="fa fa-user-circle-o"></span>&nbsp;<@spring.message "LoginlogM"/>
        </li>
        <li>
                <span>Welcome <@shiro.principal type="com.cq.web.entity.admin.User" property="nickName"/>
                </span>
        </li>
    </ul>
    <!-- PAGE CONTENT WRAPPER -->
    <div class="page-content-wrap">
        <div class="row">
            <div class="col-md-12">
                <div class="row">
                    <div class="panel-body">
                        <@shiro.hasPermission name="system:loginlog:delete">
                        <button class="btn btn-primary  btn-xs" type="button" onclick="del();"><i class="fa fa-minus"></i>&nbsp;<@spring.message "Clearall"/></button>
                        </@shiro.hasPermission>
                </div>
                <div class="col-md-12">
                    <div class="panel panel-default">
                        <div class="panel-body">
                            <div class="table-responsive">
                                <table class="table table-bordered table-striped table-actions" id="tableList"></table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>
    <!-- PAGE CONTENT WRAPPER -->
</div>
<!-- END PAGE CONTENT -->
</div>
<!-- END PAGE CONTAINER -->

<!-- MESSAGE BOX-->
<div class="message-box animated fadeIn" data-sound="alert" id="mb-signout">
    <div class="mb-container">
        <div class="mb-middle">
            <div class="mb-title"><span class="fa fa-sign-out"></span> Log <strong>Out</strong> ?</div>
            <div class="mb-content">
                <p>Are you sure you want to log out?</p>
                <p>Press No if you want to continue work. Press Yes to logout current user.</p>
            </div>
            <div class="mb-footer">
                <form action="/admin/logout" id="logout">
                    <div class="pull-right">
                        <a href="javascript:document:logout.submit();" class="btn btn-success btn-lg"><@spring.message "Yes"/></a>
                        <button class="btn btn-default btn-lg mb-control-close"><@spring.message "No"/></button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
<!-- END MESSAGE BOX-->

<script type="text/javascript">
    $(document).ready(function () {
        $("#tableList").bootstrapTable({
            //使用get请求到服务器获取数据
            method: "POST",
            //必须设置，不然request.getParameter获取不到请求参数
            contentType: "application/x-www-form-urlencoded",
            //获取数据的Servlet地址
            url: "${ctxPath}/admin/loginlog/list",
            //表格显示条纹
            striped: true,
            //启动分页
            pagination: true,
            //每页显示的记录数
            pageSize: 10,
            //当前第几页
            pageNumber: 1,
            //记录数可选列表
            pageList: [5, 10, 15, 20, 25],
            //表示服务端请求
            sidePagination: "server",
            //设置为undefined可以获取pageNumber，pageSize，searchText，sortName，sortOrder
            //设置为limit可以获取limit, offset, search, sort, order
            queryParamsType: "undefined",
            //json数据解析
            responseHandler: function(res) {
                return {
                    "rows": res.content,
                    "total": res.totalElements
                };
            },
            //数据列
            columns: [
                {title: "ID", field: "id", sortable: true},
                {title: "日志名称", field: "logName"},
                {title: "日志信息", field: "message"},
                {title: "IP地址", field: "ip"},
                {title: "用户ID", field: "userId"},
                {title: "创建时间", field: "createTime",
                    formatter: function (value, row, index) {
                        var date = new Date(value);
                        var M = (date.getMonth()+1 < 10 ? '0'+(date.getMonth()+1) : date.getMonth()+1) + '-';
                        return date.getFullYear() + '-' + M + date.getDate() + ' ' + date.getHours() + ':'+ date.getMinutes() + ':' + date.getSeconds();
                    }}
               ]
        });
    });

    function del(){
        layer.confirm('确定删除吗?', {icon: 3, title:'提示'}, function(index){
            $.ajax({
                type: "POST",
                dataType: "json",
                url: "${ctxPath!}/admin/loginlog/delete/",
                success: function(msg){
                    layer.msg(msg.message, {time: 1000},function(){
                        $('#tableList').bootstrapTable("refresh");
                        layer.close(index);
                    });
                }
            });
        });
    }
</script>
</body>
</html>